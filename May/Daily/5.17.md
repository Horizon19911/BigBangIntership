<center><h2>React Native's Unit Testing by Jest and Enzyme</h2></center>

### Requirements 
- ##### *Initialize the React Native Project*
- ##### *Add Testing Package*
- ##### *Configure Jest and Enzyme*
- ##### *Enzyme handbook*
- ##### *Jest handbook*
- ##### *React Native Unit Test*

<hr/>

#### 1. Initialize the React Native Project with Typescript

```
npx react-native init MyApp --template react-native-template-typescript
```
##### <center>Adding TypeScript to an Existing Project</center>
1. Add TypeScript and the types for React Native and Jest to your project.
```
yarn add --dev typescript @types/jest @types/react @types/react-native @types/react-test-renderer
# or for npm
npm install --save-dev typescript @types/jest @types/react @types/react-native @types/react-test-renderer
```
2. Add a TypeScript config file. Create a <mark>tsconfig.json</mark> in the root of your project:
```
{
  "compilerOptions": {
    "allowJs": true,
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "isolatedModules": true,
    "jsx": "react",
    "lib": ["es6"],
    "moduleResolution": "node",
    "noEmit": true,
    "strict": true,
    "target": "esnext"
  },
  "exclude": [
    "node_modules",
    "babel.config.js",
    "metro.config.js",
    "jest.config.js"
  ]
}
```
3. Create a <mark>jest.config.js</mark> file to configure Jest to use TypeScript
```
module.exports = {
  preset: 'react-native',
  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node']
};
```
4. Rename a JavaScript file to be *.tsx
> You should leave the ./index.js entrypoint file as it is otherwise you may run into an issue when it comes to bundling a production build.

5. Run <mark>yarn tsc</mark> to type-check your new TypeScript files.
<hr/>

#### 2. Add Testing Packages
 After we initialized the project, letâ€™s add the testing tools.

 ```
 npm install --save-dev enzyme enzyme-adapter-react-16 react-dom jest-fetch-mock ts-jest
//æˆ‘è§‰å¾—TTAæ›´å¥½
yarn add enzyme enzyme-adapter-react-16 --dev // ref from TTA

 ```
 We donâ€™t have to install Jest, because React Native ships with it. Hooray for Facebook enforcing the best practice of unit testing ğŸ”¥!
Additionally, we have to add types to unleash the full power of TypeScript.

```
npm install --save-dev @types/enzyme @types/enzyme-adapter-react-16
```
If you want to use Git, modify your <mark>.gitignore</mark> to ignore Jestâ€™s files:
```
# Jest
#
.jest/
coverage/
```
<hr/>
#### Configure Jest and Enzyme
In the all following context are ref by TTA
- ***Create a jest.config.json file in rootDir.***
```
{
	"preset": "react-native",
	"collectCoverage": true,
	"moduleDirectories": [
		"node_modules",
		"src"
	],
	"transform": {
		"^.+\\.js$": "<rootDir>/node_modules/react-native/jest/preprocessor.js"
	},
	"setupFiles": [
		"<rootDir>/jest/setup.js"
	],
	"transformIgnorePatterns": [
		"node_modules/(?!(jest-)?react-native)"
	],
	"coveragePathIgnorePatterns": [
		"/node_modules/",
		"/jest"
	]
}
```
- Create a folder called <mark>jest</mark> inside rootDir and then create <mark>setup.js</mark> file in <mark>rootDir/jest/ </mark>folder.
```
import Enzyme from 'enzyme';
import Adapter from 'enzyme-adapter-react-16';

Enzyme.configure({ adapter: new Adapter() });

```
- Create Button.js and Button.test.js in the same folder
In Button.js
```
import React from 'react';
import { Text, TouchableOpacity } from 'react-native';

const Button = (props) => {
    const { buttonStyle, textStyle } = styles;
    const { onPress, label } = props
    return (
        <TouchableOpacity onPress={onPress} style={buttonStyle}>
            <Text style={textStyle}>
                {label}
            </Text>
        </TouchableOpacity>
    );
};

const styles = {
    textStyle: {
        alignSelf: 'center',
        color: '#fff',
        fontSize: 16,
        fontWeight: '600',
    },
    buttonStyle: {
        height: 45,
        alignSelf: 'stretch',
        justifyContent: 'center',
        backgroundColor: '#38ba7d',
        borderBottomWidth: 6,
        borderBottomColor: '#1e6343',
        borderWidth: 1,
        marginLeft: 15,
        marginRight: 15
    }
};

export default Button;
```
In Button.test.js
```
import React from 'react';
import {shallow} from 'enzyme';
import Button from './Button';

describe('Button', () => {
    describe('Rendering', () => {
        it('should match to snapshot', () => {
            const component = shallow(<Button label="test label"/>)
            expect(component).toMatchSnapshot()
        });
    });
});
```
- Then run test 
```
yarn run test
```
<hr/>

#### *Enzyme handbook*
Enzymeæ˜¯Airbnbå¼€æºçš„Reactæµ‹è¯•å·¥å…·åº“ï¼Œå®ƒé€šè¿‡å¯¹å®˜æ–¹æä¾›çš„æµ‹è¯•å·¥å…·ReactTestUtilsè¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œæä¾›äº†ä¸€å¥—ç®€æ´å¼ºå¤§çš„APIï¼Œç±»ä¼¼jQueryçš„é£æ ¼ï¼Œå¹¶ä¸”å†…ç½®Cheerioã€‚
##### *3ç§æ¸²æŸ“æ¨¡å¼*
- renderï¼šé™æ€æ¸²æŸ“ï¼Œå®ƒå°†Reactç»„ä»¶æ¸²æŸ“æˆé™æ€çš„HTMLå­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨Cheerioè¿™ä¸ªåº“è§£æè¿™æ®µå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ªCheerioçš„å®ä¾‹å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥åˆ†æç»„ä»¶çš„htmlç»“æ„ã€‚å¯¹äºsnapshotä½¿ç”¨renderæ¯”è¾ƒåˆé€‚ã€‚
- shadowï¼šæµ…æ¸²æŸ“ï¼Œæ˜¯å¯¹å®˜æ–¹çš„Shallow Rendererçš„å°è£…ã€‚å°†ç»„ä»¶æ¸²æŸ“æˆè™šæ‹ŸDOMå¯¹è±¡ï¼Œåªä¼šæ¸²æŸ“ç¬¬ä¸€å±‚ï¼Œå­ç»„ä»¶å°†ä¸ä¼šè¢«æ¸²æŸ“å‡ºæ¥ï¼Œä½¿å¾—æ•ˆç‡éå¸¸é«˜ã€‚
- mountï¼šå®Œå…¨æ¸²æŸ“ï¼Œå®ƒå°†ç»„ä»¶æ¸²æŸ“åŠ è½½æˆä¸€ä¸ªçœŸå®çš„DOMèŠ‚ç‚¹ï¼Œç”¨æ¥æµ‹è¯•DOM APIçš„äº¤äº’å’Œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ç”¨åˆ°äº†jsdomæ¥æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ

>shallowå’Œmountå¯¹ç»„ä»¶çš„æ¸²æŸ“ç»“æœä¸æ˜¯htmlçš„domæ ‘ï¼Œè€Œæ˜¯reactæ ‘ã€‚å¹¶ä¸”shallowå’Œmountè¿”å›çš„ç»“æœæ˜¯ä¸ªè¢«å°è£…çš„ReactWrapperï¼Œå¯ä»¥è¿›è¡Œå¤šç§æ“ä½œï¼Œæ¯”å¦‚ï¼šfind()ã€children()ç­‰é€‰æ‹©å™¨è¿›è¡Œå…ƒç´ æŸ¥æ‰¾ï¼Œstate()ã€props()è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼ŒsetState()ã€setprops()æ“ä½œæ•°æ®ï¼›simulate()æ¨¡æ‹Ÿäº‹ä»¶è§¦å‘ã€‚

##### *å¸¸ç”¨æ–¹æ³•*
- simulate(event, mock)ï¼šæ¨¡æ‹Ÿäº‹ä»¶ï¼Œç”¨æ¥è§¦å‘äº‹ä»¶ï¼Œeventä¸ºäº‹ä»¶åç§°ï¼Œmockä¸ºä¸€ä¸ªevent objectã€‚
- instance()ï¼šè¿”å›ç»„ä»¶çš„å®ä¾‹ã€‚
- find(selector)ï¼šæ ¹æ®é€‰æ‹©å™¨æŸ¥æ‰¾èŠ‚ç‚¹ï¼Œselectorå¯ä»¥æ˜¯CSSä¸­çš„é€‰æ‹©å™¨ï¼Œæˆ–è€…æ˜¯ç»„ ä»¶çš„æ„é€ å‡½æ•°ï¼Œç»„ä»¶çš„display nameç­‰ã€‚
- text()ï¼šè¿”å›å½“å‰ç»„ä»¶çš„æ–‡æœ¬å†…å®¹ã€‚
- html()ï¼š è¿”å›å½“å‰ç»„ä»¶çš„HTMLä»£ç å½¢å¼ã€‚
- props()ï¼šè¿”å›æ ¹ç»„ä»¶çš„æ‰€æœ‰å±æ€§ã€‚
- prop(key)ï¼šè¿”å›æ ¹ç»„ä»¶çš„æŒ‡å®šå±æ€§ã€‚
- state()ï¼šè¿”å›æ ¹ç»„ä»¶çš„çŠ¶æ€ã€‚
- setState(nextState)ï¼šè®¾ç½®æ ¹ç»„ä»¶çš„çŠ¶æ€ã€‚
- setProps(nextProps)ï¼šè®¾ç½®æ ¹ç»„ä»¶çš„å±æ€§ã€‚
